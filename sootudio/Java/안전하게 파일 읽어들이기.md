## 개요

- 회사에서 파일을 읽는 jps 코드를 검토하며, 파일을 읽어들일 시 어떤 것들을 검증해야 안전하게 파일을 읽어들일 수 있는지 정리해 봤습니다.

- 지피티한테 물어봤을때 아래 구조가 2000년대 si에서 많이 쓰는 전형적인 레거시 코드라고 하더군요. 뭔가 코드에도 유행이 있는 것 같아 신기했습니다.

## 결과

### 1. 임의 파일 접근(Path Traversal / Arbitrary File Read) 가능성

```java
String filePath = "/" + request.getParameter("filePath");
String file_name = request.getParameter("fileName");
File file = new File(filePath + file_name);
```

- 사용자 입력으로 파일 경로를 조립해 서버 파일을 그대로 스트리밍하는 구조라, 검증이 미흡하면 서버 내 임의 파일 열람으로 이어질 수 있음.

- 파일 경로와 이름을 읽을 때 검증을 해야 함.
- 가장 기본적인 검증으로는 아래의 5가지가 있음

```java

if (file_name == null
    || file_name.indexOf("..") >= 0
    || file_name.indexOf("\\") >= 0
    || file_name.indexOf('\r') >= 0
    || file_name.indexOf('\n') >= 0) {
    
    // 예외처리 등..
}
```
