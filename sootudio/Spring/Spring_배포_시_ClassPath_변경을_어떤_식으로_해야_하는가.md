## ❓ 궁금증

> 워키 프로젝트를 하면서, 개발 기간을 많이 늦추는 일이 하나 발생했습니다.

> SpringBoot로 만든 백엔드 어플리케이션에 FCM(서버 SDK)를 붙히는 작업을 하고 있었는데, 로컬에서는 잘 되는 기능이 서버에 배포하면 500(서버 오류)만 나오는 문제를 겪었습니다.

> 이에 Firebase에 대한 이해도가 부족하다고 생각했지만, 결론적으로 Spring 배포 시의 키 경로를 잘못 설정한 바람에 생긴 문제였어서... Spring에 대해 더욱 공부할 필요성을 느꼈기에, 해당 이슈와 해결 과정을 정리합니다.

## 상황 요약

- FCM 테스트 API를 만들었습니다.
- 로컬(Postman)에서 해당 기능을 테스트할때는 정상으로 나왔습니다.
  
  ```json
  {
    "status" : 500,
    "message" : "FCM 메시지 전송에 실패했습니다."
  }
  ```
  -  `CustomException`을 사용했기 때문에, 상태만 500이고, 메시지는 저런 식으로 나오는 게 맞습니다.
  -  서버단에서 단독으로 200이 나오는 테스트를 못 하기 때문에, 이렇게 기능이 완성됐다고 생각하고 진행했습니다.

- 그런데, 서버를 배포하고 Swagger에서 테스트 하니 해당 기능이 실패했습니다.
  
  ```json
  {
    "status" : 500,
    "message" : "서버 내부 오류 발생!"
  }
  ```
  
  - 똑같이 500이 떨어지는 건 맞았지만, 제가 설정한 `CustomException`의 예외가 아닌, 기본 500이 떨어지고 있었습니다.
  - 또한, 로그를 살펴보니 해당 요청을 보낼 때 불필요한 스택트레이스가 엄청나게 많이 찍힌다는 것을 확인하였습니다.

- 로그 내부에서 `HttpMediaTypeNotSupportedException` (Content-Type 문제) 도 확인되었습니다.
- DTO에서 전달하는 `Token`의 문제인가 하여 토큰 검증 로직을 추가했지만, 이것도 원인이 아니였습니다.
- 따라서, **FCM 호출 전에 무언가 잘못되어 컨트롤러/서비스의 커스텀 예외로 변환되기 전에(비즈니스 로직에 도달하기 전에) 500 에러가 발생한다는 것**을 알 수 있었습니다.

## 원인

## 해결 방법

## 결과
