## 궁금증

저는 백엔드 개발자이지만, 트랜잭션에 대해서 피상적으로만 알고 있습니다.

부끄럽지만 아직 쿼리를 짤 때 트랜젝션을 제대로 짜서 실행해 본 적이 없습니다. 
하지만 현업에 들어오니, 트랜잭션, 롤백 등에 대한 개념을 잘 알고 있어야 개발할 때 실수를 줄이고, 실수에 대한 대응을 잘 할수 있겠다는 생각이 들었습니다.

그래서, DB 사용을 좀 더 잘하는 개발자가 될 수 있도록, 이 기회를 통해 DB에서의 트랜잭션에 대해서 한번 정리해 보려고 합니다.

</br>

## 트랜잭션의 전형적인 구조

DB 트랜잭션의 전형적인 구조는 다음과 같습니다. 

```sql
BEGIN;

-- 여러 작업 수행
UPDATE ...
INSERT ...
DELETE ...

-- 모든 작업이 성공하면
COMMIT;

-- 중간에 문제가 생기면
ROLLBACK;
```

기본적인 개념만 설명해 보자면, 아래와 같습니다.

| 키워드 | 의미 |
| --- | --- |
| BEGIN | 트랜잭션을 시작한다 (이후의 작업은 묶어서 처리됨) |
| COMMIT | 지금까지의 작업을 확정한다. |
| ROLLBACK | 지금까지의 작업을 취소한다. |

각 키워드들과 트랜잭션의 세부적인 특성에 대해서는, 아래에 하나하나 자세히 설명하며 공부해 보겠습니다.

</br>

## `BEGIN` 키워드

시작은 이전 커밋에서 제가 궁금증이 생겼었던 `BEGIN` 키워드 부터 시작하겠습니다.
놀랍게도 이 개발자는 `BEGIN` 키워드를 사용해 본 적이 없어서, 어떠한 역할을 하는지를 제대로 모르고 있었습니다.

나중에 제가 유명해졌을때(?) 이 글이 파묘당해서 사람들에게 충격을 주지 않을까... 하는 상상을 한번 해보며 일단 지금은 저를 아무도 모르니 그냥 공부하는 기분으로 시작하겠습니다.

### `BEGIN`의 의미

SQL에서 `BEGIN` 키워드는 트랜잭션(Transaction)을 시작한다는 의미입니다.

```sql
BEGIN;
```

-> 트랜잭션 블록 시작
이후에 수행하는 작업들은 **묶음(하나의 트랜잭션)** 으로 처리됩니다.

### `BEGIN`이 필요한 이유

#### 1. 여러 작업을 하나의 단위로 묶기 위해
- 위에도 말했듯이, 하나의 트랜잭션으로 설정을 하면 중간에 한 작업이 실패하면 전체 취소할 수 있도록 합니다.
- 이는 DB 트랜잭션이 안전하게 수행된다는 것을 보장하기 위한 성질을 가리키는 ACID 중 **Atomicity, 즉 원자성을 지키기 위해서입니다.**

#### 2. 자동 커밋(autocommit)을 끄기 위해
- 대부분의 DB는 기본적으로 한 줄을 실행하면 자동으로 커밋이 된다고 합니다. 이렇게 되면 중간 실패 시 롤백을 할 수 없게 됩니다.
- `BEGIN`을 사용하면 이런 자동 커밋 기능을 해제할 수 있습니다.

### `BEGIN`이 트랜잭션에 포함시키는 것.

이쯤 되면, BEGIN 키워드로 묶이는 것들에는 어떤 구문들이 있는지 궁금해 질 수 밖에 없습니다. ~안궁금하셨다구요? 그래도 계속 읽어주세요~

| 구문 예시 | 포함 여부 | 설명 |
| --- | --- | --- |
| `INSERT`, `UPDATE`, `DELETE` | O | 데이터 변경 작업들 |
| `SELECT ... FOR UPDATE` | O | 동시성 제어용 SELECT |
| `CREATE TABLE`, `DROP TABLE` | X (MySQL 기준) | 대부분 트랜잭션과 별개로 처리됨 (DDL은 예외) |

- *참고로, DDL은 DBMS마다 다르며, PostgreSQL은 일부 DDL도 트랜잭션 내에서 사용 가능하다고 합니다.

### DBMS별 트랜잭션 관련 키워드 차이

| DBMS | 트랜잭션 시작 키워드 | 비고 |
| --- | --- | --- |
| MySQL | `START TRANSACTION` 또는 `BEGIN` | 동일 기능 |
| PostgreSQL | `BEGIN` | 표준 |
| Oracle | 트랜잭션은 DML 실행 시 자동 시작 | `BEGIN` 키워드 없음 (PL/SQL에서는 블록 시작용으로 사용) |
| SQL Server | `BEGIN TRANSACTION` | 명확하게 명시해야 함 |

